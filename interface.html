<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>TimeCapsule</title>
    <script language="javascript" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdn.rawgit.com/ethereum/web3.js/1.0/dist/web3.min.js"></script>
  </head>
  <body>
		<h1>TimeCapsule</h1>
		<div>
			<label for="address">Veuillez entrer l'adresse de votre contrat</label>
			<input type="text" id="address" name="address" required>
		</div>
		<div>
		<button type="button" onClick="getMessage();">Valider</button>

		<h1>Votre message: </h1>
		<h1 id="response"></h1>
    <script>
			if (typeof web3 !== 'undefined') {
				web3 = new Web3(web3.currentProvider);
			} else {
				$("#response").text("ERREUR: Vous devez installer Metamask")
			}

	 	 async function getMessage() {
			const address = document.getElementById("address").value;
			const abi = [{"constant":true,"inputs":[],"name":"getMessage","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_message","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]
			const contract = new web3.eth.Contract(abi, address);
			let account = await web3.eth.getAccounts()
			contract.methods.getMessage().call({from: account[0]}).then(function(message){
				$("#response").text(message)
			})
		 .catch(function(err){
			 $("#response").text("ERREUR: Message non récupéré,")
		 })
		}
    </script>
  </body>
</html>


